<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>ShadowStock 影子证券 - 编辑器</title>
    <link href="content/bootstrap.css" rel="stylesheet" />
    <link href="content/bootstrap-theme.css" rel="stylesheet" />
    <link href="content/site.css" rel="stylesheet" />
</head>
<body>
    <div class="container-editor">
        <div class="input-group input-group-sm show-grid">
            <span class="input-group-addon">成本价</span>
            <input type="text" class="form-control" id="cost" placeholder="示例: 12.34">
        </div>
        <div class="input-group input-group-sm show-grid">
            <span class="input-group-addon">持有量</span>
            <input type="text" class="form-control" id="quantity" placeholder="示例: 1000">
        </div>
        <input type="button" class="btn btn-sm btn-danger" data-action="save" value="保存" />
        <input type="button" class="btn btn-sm btn-default" data-action="cancel" value="取消" />
    </div>

    <script src="scripts/jquery-1.10.2.js"></script>
    <script src="scripts/jquery.query.js"></script>
    <script type="text/javascript">
        $(function () {
            var inputs = $('input');
            var intelliEnter = function (event) {
                if (event.keyCode == 13) {
                    var next = inputs[inputs.index($(this)) + 1];
                    if (next.type == 'button' || next.type == 'submit' || next.type == 'image') {
                        next.click();
                    }
                    else {
                        next.focus();
                    }
                    event.preventDefault();
                }
            }
            var intelliFocus = function (){
                $(this).select();
            }

            var query = $.query(window.location.href);
            $('#cost').val($.isNumeric(query.cost) ? query.cost : '').bind({
                keydown: intelliEnter,
                focus: intelliFocus
            }).focus();
            $('#quantity').val($.isNumeric(query.quantity) ? query.quantity : '').bind({
                keydown: intelliEnter,
                focus: intelliFocus
            });

            $('[data-action]').click(function () {
                var callbackArgs = {
                    token: query.token,
                    result: $(this).data('action')
                };

                $('.form-control').each(function () {
                    var control = $(this);
                    callbackArgs[control.attr('id')] = control.val();
                });

                eval('window.parent.' + query.callback + '(callbackArgs)');
            });
        });
    </script>
</body>
</html>
